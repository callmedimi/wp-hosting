services:
  # ==========================================
  # [UI] HOMEPAGE (The Single Pane of Glass)
  # ==========================================
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: central_dashboard
    volumes:
      - ./homepage:/app/config
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ../../sites:/app/sites
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.homepage.rule=Host(`panel.localhost`)"
      - "traefik.http.routers.homepage.entrypoints=websecure"
      - "traefik.http.routers.homepage.tls=true"
      - "traefik.http.services.homepage.loadbalancer.server.port=3000"
    networks:
      - wp_shared_net
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 256M
    healthcheck:
      test: [ "CMD", "wget", "--spider", "-q", "http://localhost:3000" ]
      interval: 1m
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # ==========================================
  # [NEW] DOZZLE (Real-time Log Viewer)
  # ==========================================
  dozzle:
    image: amir20/dozzle:latest
    container_name: central_logs
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.logs.rule=Host(`logs.localhost`)"
      - "traefik.http.routers.logs.entrypoints=websecure"
      - "traefik.http.routers.logs.tls=true"
      - "traefik.http.services.logs.loadbalancer.server.port=8080"
    networks:
      - wp_shared_net
    deploy:
      resources:
        limits:
          cpus: '0.15'
          memory: 128M
    healthcheck:
      test: [ "CMD", "/dozzle", "healthcheck" ]
      interval: 1m
    restart: unless-stopped

networks:
  wp_shared_net:
    external: true
